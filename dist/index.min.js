"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var a;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,l=!0,o=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return l=e.done,e},e:function(e){o=!0,r=e},f:function(){try{l||null==a.return||a.return()}finally{if(o)throw r}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function isValidAlgorithmConfiguration(e){var a={male:{},female:{}},t=(e.male.map(function(e){return e.name}),e.female.map(function(e){return e.name})),n=[].concat(_toConsumableArray(e.male),_toConsumableArray(e.female)),i=n.map(function(e){return e.name});if(new Set(i).size!==i.length)return!1;var r,l=_createForOfIteratorHelper(n);try{for(l.s();!(r=l.n()).done;){var o=r.value,s=o.name,u=o.preferences;if(!o||!s||!u)return!1;var c=-1==t.indexOf(s)?"male":"female";a[c][s]=a[c][s]?a[c][s]+1:1;var d,m=_createForOfIteratorHelper(u);try{for(m.s();!(d=m.n()).done;){var f=d.value,h="male"==c?"female":"male";a[h][f]=a[h][f]?a[h][f]+1:1}}catch(e){m.e(e)}finally{m.f()}}}catch(e){l.e(e)}finally{l.f()}for(var g in a){var p=function(e){var t=Object.values(a[e]);if(!t.every(function(e){return e==t[0]}))return{v:!1}}(g);if("object"===_typeof(p))return p.v}return!0}var SMEntity=function(){function r(e,t,a){_classCallCheck(this,r),this.parent=e,this.name=t,this.partner=null,this.preferences=[],this._preferences=a,this.rejects=[];var n,i=_createForOfIteratorHelper(a);try{for(i.s();!(n=i.n()).done;)t=n.value,this.preferences.push(this.parent.getIndexByName(t))}catch(e){i.e(e)}finally{i.f()}}return _createClass(r,[{key:"changePartnerFor",value:function(e){if(null==this.partner)return!0;var t=this.parent.getIndexByName(this.partner.name),a=this.parent.getIndexByName(e.name);return this.preferences.indexOf(t)>this.preferences.indexOf(a)}},{key:"addRejection",value:function(e){e.rejects.push(this.parent.getIndexByName(this.name)),this.rejects.push(this.parent.getIndexByName(e.name))}},{key:"getNonRejectedPreferenceIndex",value:function(){for(var e=0;e<this.preferences.length;++e)if(-1==this.rejects.indexOf(this.preferences[e]))return this.preferences[e];return-1}}]),r}(),StableMarriage=function(){function g(e,t){if(_classCallCheck(this,g),this.log=new ProcessLogger,this.nameIndex=t||{},this.male=[],this.female=[],this.single=[],this.nosolution=[],0==Object.keys(this.nameIndex).length)for(var a in e)for(var n=0;n<e[a].length;++n){var i=e[a][n].name;this.nameIndex[i]=n}var r,l=_createForOfIteratorHelper(e.male);try{for(l.s();!(r=l.n()).done;){var o=r.value,s=o.name,u=o.preferences;this.male.push(new SMEntity(this,s,u)),this.single.push(this.male[this.male.length-1])}}catch(e){l.e(e)}finally{l.f()}var c,d=_createForOfIteratorHelper(e.female);try{for(d.s();!(c=d.n()).done;){var m=c.value,f=m.name,h=m.preferences;this.female.push(new SMEntity(this,f,h))}}catch(e){d.e(e)}finally{d.f()}}return _createClass(g,[{key:"getIndexByName",value:function(e){return this.nameIndex[e]}},{key:"engage",value:function(e,t){(e.partner=t).partner=e}},{key:"iterate",value:function(){var e,t,a;this.isDone()||(this.log.beginProcess(),e=this.single[0],t=this.female[e.getNonRejectedPreferenceIndex()],e.rejects.length!=this.female.length?(this.log.addProcess("prepare",{male:e,female:t}),null==t.partner?(this.engage(e,t),this.single.shift(),this.log.addProcess("engage",{male:e,female:t})):t.partner&&(a=t.partner,t.changePartnerFor(e)?(a.addRejection(a.partner),a.partner=null,this.single.push(this.male[this.getIndexByName(a.name)]),this.engage(e,t),this.single.shift(),this.log.addProcess("break",{male:e,female:t,dumped:a})):(e.addRejection(t),this.log.addProcess("reject",{male:e,female:t}))),this.log.addProcess("done",{male:e,female:t}),this.log.endProcess()):this.nosolution.push(this.single.shift()))}},{key:"isDone",value:function(){return 0==this.single.length}}]),g}(),defaultEntityCountMinimum=1,defaultEntityCountMaximum=10,defaultEntityNameMaximum=12,defaultAlgorithmConfiguration={male:[{name:"Conrad",preferences:["Sophie","Nicole","Emma","Olivia","Ava"]},{name:"Joshua",preferences:["Ava","Nicole","Sophie","Emma","Olivia"]},{name:"William",preferences:["Sophie","Olivia","Nicole","Ava","Emma"]},{name:"Lucas",preferences:["Nicole","Emma","Ava","Sophie","Olivia"]},{name:"Oliver",preferences:["Olivia","Emma","Nicole","Ava","Sophie"]}],female:[{name:"Ava",preferences:["Conrad","Joshua","William","Lucas","Oliver"]},{name:"Emma",preferences:["Joshua","William","Conrad","Lucas","Oliver"]},{name:"Nicole",preferences:["Oliver","Conrad","Lucas","William","Joshua"]},{name:"Olivia",preferences:["Oliver","Lucas","Joshua","William","Conrad"]},{name:"Sophie",preferences:["Lucas","Joshua","Oliver","Conrad","William"]}]},maleNames=["Aiden","Alexander","Andrew","Anthony","Asher","Benjamin","Caleb","Carter","Christopher","Daniel","David","Dylan","Elijah","Ethan","Gabriel","Grayson","Henry","Issac","Jack","Jackson","Jacob","James","Jaxon","Jayden","John","Joseph","Joshua","Julian","Leo","Levi","Liam","Lincoln","Logan","Lucas","Luke","Mason","Mateo","Matthew","Michael","Nathan","Noah","Oliver","Owen","Ryan","Samuel","Sebastian","Theodore","Thomas","William","Wyatt"],femaleNames=["Abigail","Addison","Amelia","Aria","Aubrey","Audrey","Aurora","Ava","Avery","Bella","Brooklyn","Camila","Charlotte","Chloe","Claire","Eleanor","Elizabeth","Ella","Ellie","Emily","Emma","Evelyn","Grace","Hannah","Harper","Hazel","Isabella","Layla","Leah","Lillian","Lily","Luna","Madison","Mia","Mila","Natalie","Nora","Olivia","Penelope","Riley","Savannah","Scarlett","Skylar","Sofia","Sophia","Stella","Victoria","Violet","Zoe","Zoey"],ProcessLogger=function(){function e(){_classCallCheck(this,e),this.history=[],this.index={start:null,end:null}}return _createClass(e,[{key:"beginProcess",value:function(){this.index.start=this.history.length}},{key:"endProcess",value:function(){this.index.end=this.history.length}},{key:"addProcess",value:function(e,t){this.history.push({process:e,content:t})}},{key:"getBefore",value:function(){return this.history.slice(0,this.index.start)}},{key:"getCurrent",value:function(){return this.history.slice(this.index.start,this.index.end)}},{key:"getAfter",value:function(){return this.history.slice(this.index.end)}}]),e}(),Notifier=function(){function t(e){_classCallCheck(this,t),this.element=e,this.queueLimit=5,this.queue=[]}return _createClass(t,[{key:"show",value:function(e,t,a,n){this.element.classList.add(e),this.element.innerHTML=t,setTimeout(function(){this.element.className="",n.bind(this)()}.bind(this),a)}},{key:"queueMessage",value:function(e,t,a){var n=0<arguments.length&&void 0!==e?e:"empty",i=1<arguments.length&&void 0!==t?t:"",r=2<arguments.length&&void 0!==a?a:1500;"empty"!==n&&this.queue.length+1<=this.queueLimit&&this.queue.push({type:n,message:i,duration:r,active:!1,done:!1});var l=this.queue[0];!l||l.active||l.done||(this.queue[0].active=!0,this.show(l.type,l.message,l.duration,function(){this.queue[0].done=!0,this.queue.shift(),this.queueMessage()}))}}]),t}(),mainGridDOM=document.getElementById("main-grid"),orientationWarningDOM=document.getElementById("orientation-warning");function mainGridOrientationCheck(){if(window.innerHeight>=window.innerWidth)return mainGridDOM.style.display="none",void(orientationWarningDOM.style.display="block");mainGridDOM.style.removeProperty("display"),orientationWarningDOM.style.removeProperty("display")}window.addEventListener("resize",function(){mainGridOrientationCheck()}),mainGridOrientationCheck();var stableMarriageConfiguration,stableMarriageAlgorithm,stableMarriageNameIndex,TimeoutQueue=function(){function e(){_classCallCheck(this,e),this.queue=[],this.disable=!1}return _createClass(e,[{key:"add",value:function(e,t,a){var n;2<arguments.length&&void 0!==a&&a||this.queue.push({callback:e,duration:t,active:!1,done:!1}),this.disable||(!(n=this.queue[0])||n.active||n.done||(this.queue[0].active=!0,setTimeout(function(){try{this.queue[0].done=!0,n.callback(),this.queue.shift(),this.add(null,null,!0)}catch(e){}}.bind(this),n.duration)))}},{key:"pause",value:function(){this.disable=!0}},{key:"clear",value:function(){this.queue=[]}},{key:"continue",value:function(){this.disable=!1,this.add(null,null,!0)}}]),e}(),maleDOM=document.getElementById("male"),groundDOM=document.getElementById("ground"),femaleDOM=document.getElementById("female"),maleAddDOM=document.getElementById("male-add"),femaleAddDOM=document.getElementById("female-add"),controlsDOM=document.getElementById("main-controls"),randomConfigurationDOM=document.getElementById("random-configuration"),resetDefaultDOM=document.getElementById("reset-default"),saveConfigurationDOM=document.getElementById("save-configuration"),fileInputDOM=document.getElementById("file-input"),fileInputLabelDOM=document.getElementById("file-input-label"),playVisualizationDOM=document.getElementById("play-visualization"),pauseVisualizationDOM=document.getElementById("pause-visualization"),stopVisualizationDOM=document.getElementById("stop-visualization"),skipVisualizationDOM=document.getElementById("skip-visualization"),notifier=new Notifier(document.getElementById("notifier")),stableMarriageProcessQueue=[],stableMarriageVisualizationRunning=!1,stableMarriageVisualizationDone=!1,animationQueue=new TimeoutQueue;function clone(e){return JSON.parse(JSON.stringify(e))}function shuffleArray(e){for(var t,a,n=e.length;0!==n;)a=Math.floor(Math.random()*n),t=e[--n],e[n]=e[a],e[a]=t;return e}function randomArrayOfSize(e,t){return shuffleArray(clone(e)).slice(0,t)}function createRandomConfiguration(e,t){var a,n=randomArrayOfSize(maleNames,e),i=randomArrayOfSize(femaleNames,t),r={male:[],female:[]},l=_createForOfIteratorHelper(n);try{for(l.s();!(a=l.n()).done;){var o=a.value;r.male.push({name:o,preferences:shuffleArray(clone(i))})}}catch(e){l.e(e)}finally{l.f()}var s,u=_createForOfIteratorHelper(i);try{for(u.s();!(s=u.n()).done;){var c=s.value;r.female.push({name:c,preferences:shuffleArray(clone(n))})}}catch(e){u.e(e)}finally{u.f()}return r}function getRandomName(e){return"male"==e?maleNames[Math.floor(Math.random()*maleNames.length)]:"female"==e?femaleNames[Math.floor(Math.random()*femaleNames.length)]:void 0}function nameIndexMap(e){var t,a={};for(t in e)for(var n=0;n<e[t].length;++n){a[e[t][n].name]=n}return a}function getDOMNameIndexMap(){for(var e={},t=0,a=[].concat(_toConsumableArray(maleDOM.children),_toConsumableArray(femaleDOM.children));t<a.length;t++){var n,i=a[t];i.classList.contains("entity")&&(e[(n=i.querySelector(".name input")).value]=parseInt(n.dataset.index))}return e}function getDOMConfiguration(){for(var e={male:[],female:[]},t=0,a=[].concat(_toConsumableArray(maleDOM.children),_toConsumableArray(femaleDOM.children));t<a.length;t++){var n=a[t];if(!n.classList.contains("add-entity")){var i,r=n.parentNode==maleDOM?"male":"female",l=n.querySelector(".name input").value,o=[],s=_createForOfIteratorHelper(n.querySelector(".preference").children);try{for(s.s();!(i=s.n()).done;){var u=i.value;o.push(u.innerText)}}catch(e){s.e(e)}finally{s.f()}e[r].push({name:l,preferences:o})}}return e}function clientSaveFile(e,t,a){var n,i,r=new Blob([e],{type:a});window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(r,t):(n=document.createElement("a"),i=URL.createObjectURL(r),n.href=i,n.download=t,document.body.appendChild(n),n.click(),setTimeout(function(){document.body.removeChild(n),window.URL.revokeObjectURL(i)},0))}function calculateOpenEntityHeight(e){var t=e.querySelector(".preference"),a=t.children[0].offsetHeight*t.children.length;return e.dataset.originalHeight||(e.dataset.originalHeight=e.offsetHeight),parseInt(e.dataset.originalHeight)+a}function entityPreferenceClick(e){var t=e.currentTarget.parentElement.parentElement;t.dataset.originalHeight||(t.dataset.originalHeight=t.offsetHeight),t.classList.contains("edit-preference")?t.style.removeProperty("min-height"):t.style.minHeight=calculateOpenEntityHeight(t)+"px",t.classList.toggle("edit-preference")}function entityNameInput(e){var t=e.currentTarget,a=t.selectionStart,n=/[^a-z]/gi,i=t.value;n.test(i)&&(t.value=i.replace(n,""),a--),t.setSelectionRange(a,a);for(var r=e.srcElement.parentElement.parentElement.parentElement==maleDOM?femaleDOM:maleDOM,l=0;l<r.children.length-1;++l){var o,s=_createForOfIteratorHelper(r.children[l].querySelector(".preference").children);try{for(s.s();!(o=s.n()).done;){var u=o.value;u.dataset.index==t.dataset.index&&(u.innerHTML=t.value)}}catch(e){s.e(e)}finally{s.f()}}}function entityRemoveClick(e){var t=e.currentTarget.parentNode.parentNode,a=t.parentNode;if(a.children.length-1<=defaultEntityCountMinimum)notifier.queueMessage("warning","Number of entities cannot go below minimum (".concat(defaultEntityCountMinimum,")."),500);else{var n,i=a==maleDOM?femaleDOM:maleDOM,r=t.querySelector(".name input").dataset.index,l=_createForOfIteratorHelper(a.children);try{for(l.s();!(n=l.n()).done;){var o,s,u=n.value;u==t||u.classList.contains("add-entity")||(o=u.querySelector(".name input"),r<(s=parseInt(o.dataset.index))&&(o.dataset.index=s-1))}}catch(e){l.e(e)}finally{l.f()}var c,d=_createForOfIteratorHelper(i.children);try{for(d.s();!(c=d.n()).done;){var m=c.value;if(!m.classList.contains("add-entity")){var f,h=m.querySelector(".preference"),g=void 0,p=void 0,y=_createForOfIteratorHelper(h.children);try{for(y.s();!(f=y.n()).done;){var v=f.value,M=parseInt(v.dataset.index);M==r?g=v:M-1==r?p=v:r<M&&(v.dataset.index=M-1)}}catch(e){y.e(e)}finally{y.f()}p&&(p.dataset.index=parseInt(p.dataset.index)-1),g.remove(),m.classList.contains("edit-preference")&&(m.style.minHeight=calculateOpenEntityHeight(m)+"px")}}}catch(e){d.e(e)}finally{d.f()}t.remove()}}function preferenceDrag(e){var t=e.target,a=t.parentNode;t.classList.add("dragging");var n=e.clientX,i=e.clientY,r=document.elementFromPoint(n,i);(r=null==r?t:r).parentNode==a&&(r=r!==t.nextSibling?r:r.nextSibling,a.insertBefore(t,r))}function preferenceDragEnd(e){e.target.classList.remove("dragging")}function createSMEntityElement(){var e=document.createElement("div");return e.className="entity",e.innerHTML='\n        <div class="name">\n            <button class="toggle-preference"><i class="fas fa-angle-right"></i></button> \n            <input maxlength="'.concat(defaultEntityNameMaximum,'" type="text" value="Name" placeholder="Enter Name">\n            <button class="remove-entity"><i class="fas fa-trash"></i></button>\n        </div>\n        <div class="preference">\n            \x3c!-- Put prefs here separated with <div> tags --\x3e\n        </div>\n\n    '),e}function initializeEntityElement(e,t,a,n){var i=e.querySelector(".name input"),r=e.querySelector(".name .toggle-preference"),l=e.querySelector(".name .remove-entity"),o=e.querySelector(".preference");i.value=a,i.dataset.index=t[a],i.oninput=entityNameInput,"true"!=r.getAttribute("haslistener")&&r.addEventListener("click",entityPreferenceClick),"true"!=l.getAttribute("haslistener")&&l.addEventListener("click",entityRemoveClick),r.setAttribute("haslistener","true"),l.setAttribute("haslistener","true");for(var s=0;s<n.length;++s){var u=n[s],c=void 0;o.children.length-1<s?((c=document.createElement("div")).addEventListener("drag",preferenceDrag),c.addEventListener("dragend",preferenceDragEnd),o.appendChild(c)):c=o.children[s],c.draggable=!0,c.dataset.index=t[u],c.innerHTML=u}for(var d=o.children.length-1;d>=n.length;--d)o.children[d].remove();return e}function populateDOM(r){var l,o=nameIndexMap(r),s=new TimeoutQueue;for(l in r){for(var u="male"==l?maleDOM:femaleDOM,c="male"==l?maleAddDOM:femaleAddDOM,e=(u.children.length,r[l].length,0);e<r[l].length;++e)!function(e){var t=r[l][e],a=t.name,n=t.preferences,i=void 0;e<u.children.length-1?i=u.children[e]:((i=createSMEntityElement()).style.opacity="0",u.insertBefore(i,c),s.add(function(){i.style.removeProperty("opacity")},100)),initializeEntityElement(i,o,a,n),i.classList.contains("edit-preference")&&(i.style.minHeight=calculateOpenEntityHeight(i)+"px")}(e);for(var t=u.children.length-2;t>=r[l].length;--t)u.children[t].remove()}}function addEntityClick(e){var t=e.currentTarget.parentNode;if(t.children.length-1>=defaultEntityCountMaximum)notifier.queueMessage("warning","Maximum number of entities (".concat(defaultEntityCountMaximum,") has been reached."),500);else if(stableMarriageVisualizationRunning)notifier.queueMessage("warning","Use stop button to edit configuration.");else{for(var a,n=t==maleDOM?"male":"female",i="male"==n?femaleDOM:maleDOM,r=createSMEntityElement(),l=getDOMNameIndexMap(),o=[];a=getRandomName(n),-1!=Object.keys(l).indexOf(a););l[a]=t.children.length-1;var s,u=_createForOfIteratorHelper(i.children);try{for(u.s();!(s=u.n()).done;){var c,d,m,f=s.value;f.classList.contains("add-entity")||(c=f.querySelector(".preference"),(d=document.createElement("div")).draggable=!0,d.dataset.index=l[a],d.innerHTML=a,d.addEventListener("drag",preferenceDrag),d.addEventListener("dragend",preferenceDragEnd),c.appendChild(d),(m=c.parentNode).classList.contains("edit-preference")&&(m.style.minHeight=calculateOpenEntityHeight(m)+"px"),o.push(f.querySelector(".name input").value))}}catch(e){u.e(e)}finally{u.f()}initializeEntityElement(r,l,a,shuffleArray(o)),t.insertBefore(r,e.currentTarget)}}function randomConfigurationClick(e){var t=defaultEntityCountMaximum-defaultEntityCountMinimum;populateDOM(createRandomConfiguration(Math.floor(Math.random()*(1+t))+defaultEntityCountMinimum,Math.floor(Math.random()*(1+t))+defaultEntityCountMinimum)),notifier.queueMessage("valid","Configuration has been randomized.",500)}function resetDefaultClick(e){populateDOM(defaultAlgorithmConfiguration),notifier.queueMessage("valid","Configuration has been reset to default.",1e3)}function saveConfigurationClick(e){isValidAlgorithmConfiguration(getDOMConfiguration())?(clientSaveFile(JSON.stringify(getDOMConfiguration(),null,4),"configuration.json","application/json"),notifier.queueMessage("valid","The configuration file is being saved at your device as configuration.json")):notifier.queueMessage("error","Configuration is invalid. Please use unique names for all entities.")}function validateJSONConfiguration(e){var t=e.male,a=e.female;if(!t||!Array.isArray(t))throw"Missing male array in configuration object.";if(!a||!Array.isArray(a))throw"Missing female array in configuration object.";if(t.length<defaultEntityCountMinimum)throw"Male array does not meet minimum length of required elements.";if(t.length>defaultEntityCountMaximum)throw"Male array exceeds maximum length of required elements.";if(a.length<defaultEntityCountMinimum)throw"Female array does not meet minimum length of required elements.";if(a.length>defaultEntityCountMaximum)throw"Female array exceeds maximum length of required elements.";for(var n=0,i=[].concat(_toConsumableArray(t),_toConsumableArray(a));n<i.length;n++){var r=i[n],l=r.name,o=r.preferences;if(!l||!o)throw"An entity is missing required fields.";if(!("string"==typeof l||l instanceof String)||l.length>defaultEntityNameMaximum||/[^a-z]/gi.test(l))throw"An entity has an invalid name.";if(!Array.isArray(o)||!o.every(function(e){return"string"==typeof e||e instanceof String}))throw"An entity has invalid preferences."}if(!isValidAlgorithmConfiguration(e))throw"The configuration is invalid due to inconsistencies in entity occurence."}function fileInputChange(a){var e=a.target.files[0],t=new FileReader;t.readAsText(e,"UTF-8"),t.addEventListener("load",function(e){try{var t=JSON.parse(e.target.result);validateJSONConfiguration(t),notifier.queueMessage("valid","Configuration loaded successfully."),populateDOM(t)}catch(e){notifier.queueMessage("error",e)}finally{a.target.value=""}})}function highlightEntityDOM(e){animationQueue.add(function(){e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("prepare")},250)}function openAndSelectGroundDOM(e,t){animationQueue.add(function(){e.style.removeProperty("opacity")},250),animationQueue.add(function(){e.classList.add("expand-preference"),e.style.minHeight=calculateOpenEntityHeight(e)+"px"},250),animationQueue.add(function(){e.scrollIntoView({behavior:"smooth",block:"center"})},250),null!=t&&animationQueue.add(function(){e.querySelector(".preference").children[t].classList.add("select-highlight")},500)}function closeGroundDOM(e){animationQueue.add(function(){e.classList.remove("expand-preference"),e.style.removeProperty("min-height")},500)}function makeResultInteractable(){if(stableMarriageAlgorithm){stableMarriageVisualizationDone=stableMarriageVisualizationRunning=!0,animationQueue.clear(),maleDOM.classList.remove("disabled"),groundDOM.classList.remove("disabled"),femaleDOM.classList.remove("disabled"),groundDOM.innerHTML="";for(var e=0,t=[].concat(_toConsumableArray(stableMarriageAlgorithm.male),_toConsumableArray(stableMarriageAlgorithm.female));e<t.length;e++){var a=t[e],n=a.element,i=n.querySelector(".name input"),r=n.querySelector(".name .toggle-preference"),l=n.querySelector(".name .remove-entity");i.classList.add("disabled"),r.removeEventListener("click",entityPreferenceClick),n.addEventListener("click",entityPartnerShowClick),l.removeEventListener("click",entityRemoveClick),n.classList.add("prepare"),n.classList.remove("disabled"),null!==a.partner?n.classList.add("marry"):n.classList.add("reject")}}}function animationStep(){var e,a,t=stableMarriageProcessQueue.shift(),n=t.process,i=t.content,r=i.male,l=i.female,o=i.dumped;if("done"!==n&&(e=r.element.cloneNode(!0),a=l.element.cloneNode(!0),e.style.opacity="0",a.style.opacity="0",e.classList.add("prepare"),a.classList.add("prepare"),e.classList.add("disabled"),a.classList.add("disabled"),"prepare"!==n&&(groundDOM.appendChild(e),openAndSelectGroundDOM(e,r._preferences.indexOf(l.name)))),"prepare"==n)highlightEntityDOM(r.element);else if("engage"==n)highlightEntityDOM(l.element),groundDOM.appendChild(a),openAndSelectGroundDOM(a),closeGroundDOM(e),closeGroundDOM(a),animationQueue.add(function(){e.classList.remove("reject"),a.classList.remove("prepare"),e.classList.add("engage"),a.classList.add("engage")},500),animationQueue.add(function(){r.element.classList.remove("reject"),r.element.classList.add("engage"),l.element.classList.add("engage"),notifier.queueMessage("warning","".concat(r.name," is engaged with ").concat(l.name,"."),1e3)},500);else if("break"==n){a.classList.add("engage");var s=l._preferences.indexOf(o.name);a.querySelector(".preference").children[s].classList.add("partner-highlight"),groundDOM.appendChild(a),openAndSelectGroundDOM(a),animationQueue.add(function(){var e=a.querySelector(".preference"),t=l._preferences.indexOf(r.name);l._preferences.indexOf(o.name);e.children[t].classList.add("select-highlight"),notifier.queueMessage("warning","".concat(l.name," breaks up with current partner ").concat(o.name," and engages with ").concat(r.name,"."),2e3)},500),closeGroundDOM(e),closeGroundDOM(a),animationQueue.add(function(){e.classList.remove("reject"),e.classList.add("engage"),r.element.classList.remove("reject"),r.element.classList.add("engage"),o.element.classList.remove("engage"),o.element.classList.add("reject")},500)}else if("reject"==n){a.classList.add("engage");var u=a.querySelector(".preference"),c=l._preferences.indexOf(l.partner.name);u.children[c].classList.add("partner-highlight"),groundDOM.appendChild(a),openAndSelectGroundDOM(a),animationQueue.add(function(){var e=l._preferences.indexOf(r.name);u.children[e].classList.add("select-highlight")},250),closeGroundDOM(e),closeGroundDOM(a),animationQueue.add(function(){e.classList.remove("prepare"),a.classList.remove("engage"),e.classList.add("reject"),a.classList.add("reject"),notifier.queueMessage("warning","".concat(l.name," stays with current partner ").concat(l.partner.name," and rejects ").concat(r.name,"."),2e3)},250),animationQueue.add(function(){r.element.classList.add("reject"),l.element.classList.add("reject")},250),animationQueue.add(function(){l.element.classList.remove("reject"),l.element.classList.add("engage")},250)}else if("done"==n){var d,m=_createForOfIteratorHelper(groundDOM.children);try{for(m.s();!(d=m.n()).done;){d.value.style.opacity="0"}}catch(e){m.e(e)}finally{m.f()}animationQueue.add(function(){groundDOM.innerHTML=""},250)}0==stableMarriageProcessQueue.length?(skipVisualizationDOM.classList.add("disabled"),makeResultInteractable(),notifier.queueMessage("valid","Tap an entity to show its partner.")):animationQueue.add(function(){animationStep()},250)}function playVisualizationClick(e){if(stableMarriageVisualizationDone||stableMarriageVisualizationRunning)stableMarriageVisualizationRunning&&animationQueue.disable?(animationQueue.continue(),notifier.queueMessage("valid","Visualization continuing.")):notifier.queueMessage("warning","Use the stop button to reset the visualization.");else{if(!isValidAlgorithmConfiguration(stableMarriageConfiguration=getDOMConfiguration()))return void notifier.queueMessage("warning","Configuration is invalid. Please use unique names for all entities.");for(stableMarriageNameIndex=nameIndexMap(stableMarriageConfiguration),stableMarriageAlgorithm=new StableMarriage(getDOMConfiguration(),stableMarriageNameIndex),stableMarriageProcessQueue=[];!stableMarriageAlgorithm.isDone();){stableMarriageAlgorithm.iterate(),stableMarriageProcessQueue.push.apply(stableMarriageProcessQueue,_toConsumableArray(stableMarriageAlgorithm.log.getCurrent()))}animationQueue.disable=!1;var t,a,n=_createForOfIteratorHelper(controlsDOM.children);try{for(n.s();!(t=n.n()).done;){var i=t.value;i==pauseVisualizationDOM||i==stopVisualizationDOM||i==skipVisualizationDOM?i.classList.remove("disabled"):i!==playVisualizationDOM&&i.classList.add("disabled")}}catch(e){n.e(e)}finally{n.f()}for(a in maleDOM.classList.add("disabled"),femaleDOM.classList.add("disabled"),stableMarriageConfiguration){var r,l="male"==a?maleDOM:femaleDOM,o=_createForOfIteratorHelper(stableMarriageAlgorithm[a]);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=l.children[stableMarriageNameIndex[s.name]];u.classList.remove("edit-preference"),u.style.removeProperty("min-height"),u.classList.add("disabled"),s.element=u}}catch(e){o.e(e)}finally{o.f()}}notifier.queueMessage("valid","Visualization start."),stableMarriageVisualizationRunning=!0,animationStep()}}function pauseVisualizationClick(e){animationQueue.disable||!stableMarriageVisualizationRunning||stableMarriageVisualizationDone||(animationQueue.pause(),notifier.queueMessage("valid","Visualization paused."))}function stopVisualizationClick(e){animationQueue.clear(),stableMarriageNameIndex=stableMarriageAlgorithm=null,stableMarriageVisualizationDone=stableMarriageVisualizationRunning=!(stableMarriageProcessQueue=[]);var t,a=_createForOfIteratorHelper(controlsDOM.children);try{for(a.s();!(t=a.n()).done;){var n=t.value;n==pauseVisualizationDOM||n==stopVisualizationDOM||n==skipVisualizationDOM?n.classList.add("disabled"):n.classList.remove("disabled")}}catch(e){a.e(e)}finally{a.f()}maleDOM.classList.remove("disabled"),femaleDOM.classList.remove("disabled"),groundDOM.classList.add("disabled");for(var i=new TimeoutQueue,r=0,l=[].concat(_toConsumableArray(maleDOM.children),_toConsumableArray(femaleDOM.children),_toConsumableArray(groundDOM.children));r<l.length;r++)(function(){var e=l[r];if(e.classList.contains("add-entity"))return;e.style.opacity="0",i.add(function(){e.remove()},10)})();i.add(function(){populateDOM(stableMarriageConfiguration)},200)}function entityPartnerShowClick(e){var t,a,n,i,r,l=e.currentTarget,o=l.querySelector(".name input").dataset.index,s=l.parentNode==maleDOM?"male":"female",u=stableMarriageAlgorithm[s][o];u.partner?(groundDOM.innerHTML="",t=u.partner,a=l.cloneNode(!0),n=t.element.cloneNode(!0),i=t._preferences.indexOf(u.name),r=u._preferences.indexOf(t.name),a.querySelector(".preference").children[r].classList.add("marry-highlight"),n.querySelector(".preference").children[i].classList.add("marry-highlight"),groundDOM.appendChild(a),groundDOM.appendChild(n),openAndSelectGroundDOM(a),openAndSelectGroundDOM(n)):notifier.queueMessage("warning","".concat(u.name," has no partner."))}function skipVisualizationClick(e){stableMarriageVisualizationRunning&&!stableMarriageVisualizationDone&&(e.currentTarget.classList.add("disabled"),makeResultInteractable(),notifier.queueMessage("valid","Toggle an entity with their angle button to see their partner."))}populateDOM(defaultAlgorithmConfiguration),maleAddDOM.addEventListener("click",addEntityClick),femaleAddDOM.addEventListener("click",addEntityClick),randomConfigurationDOM.addEventListener("click",randomConfigurationClick),resetDefaultDOM.addEventListener("click",resetDefaultClick),saveConfigurationDOM.addEventListener("click",saveConfigurationClick),fileInputDOM.addEventListener("change",fileInputChange),playVisualizationDOM.addEventListener("click",playVisualizationClick),pauseVisualizationDOM.addEventListener("click",pauseVisualizationClick),stopVisualizationDOM.addEventListener("click",stopVisualizationClick),skipVisualizationDOM.addEventListener("click",skipVisualizationClick);