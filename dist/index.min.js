"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var n,a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return a&&(e=a),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return r=e.done,e},e:function(e){l=!0,i=e},f:function(){try{r||null==a.return||a.return()}finally{if(l)throw i}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function isValidAlgorithmConfiguration(e){var n={male:{},female:{}},c=(e.male.map(function(e){return e.name}),e.female.map(function(e){return e.name})),e=[].concat(_toConsumableArray(e.male),_toConsumableArray(e.female)),d=e.map(function(e){return e.name});if(new Set(d).size!==d.length)return!1;var m,t=_createForOfIteratorHelper(e);try{for(t.s();!(m=t.n()).done;){var a=m.value,i=a.name,f=a.preferences;if(!a||!i||!f)return!1;var h,r=-1==c.indexOf(i)?"male":"female",l=(n[r][i]=n[r][i]?n[r][i]+1:1,_createForOfIteratorHelper(f));try{for(l.s();!(h=l.n()).done;){var o=h.value,s="male"==r?"female":"male";n[s][o]=n[s][o]?n[s][o]+1:1}}catch(e){l.e(e)}finally{l.f()}}}catch(e){t.e(e)}finally{t.f()}for(var u in n){u=function(e){var t=Object.values(n[e]);if(!t.every(function(e){return e==t[0]}))return{v:!1}}(u);if("object"===_typeof(u))return u.v}return!0}var SMEntity=function(){function r(e,t,n){_classCallCheck(this,r),this.parent=e,this.name=t,this.partner=null,this.preferences=[],this._preferences=n,this.rejects=[];var a,i=_createForOfIteratorHelper(n);try{for(i.s();!(a=i.n()).done;)t=a.value,this.preferences.push(this.parent.getIndexByName(t))}catch(e){i.e(e)}finally{i.f()}}return _createClass(r,[{key:"changePartnerFor",value:function(e){if(null==this.partner)return!0;var t=this.parent.getIndexByName(this.partner.name),e=this.parent.getIndexByName(e.name);return this.preferences.indexOf(t)>this.preferences.indexOf(e)}},{key:"addRejection",value:function(e){e.rejects.push(this.parent.getIndexByName(this.name)),this.rejects.push(this.parent.getIndexByName(e.name))}},{key:"getNonRejectedPreferenceIndex",value:function(){for(var e=0;e<this.preferences.length;++e)if(-1==this.rejects.indexOf(this.preferences[e]))return this.preferences[e];return-1}}]),r}(),StableMarriage=function(){function g(e,t){if(_classCallCheck(this,g),this.log=new ProcessLogger,this.nameIndex=t||{},this.male=[],this.female=[],this.single=[],this.nosolution=[],0==Object.keys(this.nameIndex).length)for(var n in e)for(var a=0;a<e[n].length;++a){var c=e[n][a].name;this.nameIndex[c]=a}var i,r=_createForOfIteratorHelper(e.male);try{for(r.s();!(i=r.n()).done;){var l=i.value,d=l.name,m=l.preferences;this.male.push(new SMEntity(this,d,m)),this.single.push(this.male[this.male.length-1])}}catch(e){r.e(e)}finally{r.f()}var o,s=_createForOfIteratorHelper(e.female);try{for(s.s();!(o=s.n()).done;){var u=o.value,f=u.name,h=u.preferences;this.female.push(new SMEntity(this,f,h))}}catch(e){s.e(e)}finally{s.f()}}return _createClass(g,[{key:"getIndexByName",value:function(e){return this.nameIndex[e]}},{key:"engage",value:function(e,t){(e.partner=t).partner=e}},{key:"iterate",value:function(){var e,t,n;this.isDone()||(this.log.beginProcess(),e=this.single[0],t=this.female[e.getNonRejectedPreferenceIndex()],e.rejects.length!=this.female.length?(this.log.addProcess("prepare",{male:e,female:t}),null==t.partner?(this.engage(e,t),this.single.shift(),this.log.addProcess("engage",{male:e,female:t})):t.partner&&(n=t.partner,t.changePartnerFor(e)?(n.addRejection(n.partner),n.partner=null,this.single.push(this.male[this.getIndexByName(n.name)]),this.engage(e,t),this.single.shift(),this.log.addProcess("break",{male:e,female:t,dumped:n})):(e.addRejection(t),this.log.addProcess("reject",{male:e,female:t}))),this.log.addProcess("done",{male:e,female:t}),this.log.endProcess()):this.nosolution.push(this.single.shift()))}},{key:"isDone",value:function(){return 0==this.single.length}}]),g}(),defaultEntityCountMinimum=1,defaultEntityCountMaximum=10,defaultEntityNameMaximum=12,defaultAlgorithmConfiguration={male:[{name:"Conrad",preferences:["Sophie","Nicole","Emma","Olivia","Ava"]},{name:"Joshua",preferences:["Ava","Nicole","Sophie","Emma","Olivia"]},{name:"William",preferences:["Sophie","Olivia","Nicole","Ava","Emma"]},{name:"Lucas",preferences:["Nicole","Emma","Ava","Sophie","Olivia"]},{name:"Oliver",preferences:["Olivia","Emma","Nicole","Ava","Sophie"]}],female:[{name:"Ava",preferences:["Conrad","Joshua","William","Lucas","Oliver"]},{name:"Emma",preferences:["Joshua","William","Conrad","Lucas","Oliver"]},{name:"Nicole",preferences:["Oliver","Conrad","Lucas","William","Joshua"]},{name:"Olivia",preferences:["Oliver","Lucas","Joshua","William","Conrad"]},{name:"Sophie",preferences:["Lucas","Joshua","Oliver","Conrad","William"]}]},maleNames=["Aiden","Alexander","Andrew","Anthony","Asher","Benjamin","Caleb","Carter","Christopher","Daniel","David","Dylan","Elijah","Ethan","Gabriel","Grayson","Henry","Issac","Jack","Jackson","Jacob","James","Jaxon","Jayden","John","Joseph","Joshua","Julian","Leo","Levi","Liam","Lincoln","Logan","Lucas","Luke","Mason","Mateo","Matthew","Michael","Nathan","Noah","Oliver","Owen","Ryan","Samuel","Sebastian","Theodore","Thomas","William","Wyatt"],femaleNames=["Abigail","Addison","Amelia","Aria","Aubrey","Audrey","Aurora","Ava","Avery","Bella","Brooklyn","Camila","Charlotte","Chloe","Claire","Eleanor","Elizabeth","Ella","Ellie","Emily","Emma","Evelyn","Grace","Hannah","Harper","Hazel","Isabella","Layla","Leah","Lillian","Lily","Luna","Madison","Mia","Mila","Natalie","Nora","Olivia","Penelope","Riley","Savannah","Scarlett","Skylar","Sofia","Sophia","Stella","Victoria","Violet","Zoe","Zoey"],ProcessLogger=function(){function e(){_classCallCheck(this,e),this.history=[],this.index={start:null,end:null}}return _createClass(e,[{key:"beginProcess",value:function(){this.index.start=this.history.length}},{key:"endProcess",value:function(){this.index.end=this.history.length}},{key:"addProcess",value:function(e,t){this.history.push({process:e,content:t})}},{key:"getBefore",value:function(){return this.history.slice(0,this.index.start)}},{key:"getCurrent",value:function(){return this.history.slice(this.index.start,this.index.end)}},{key:"getAfter",value:function(){return this.history.slice(this.index.end)}}]),e}(),Notifier=function(){function t(e){_classCallCheck(this,t),this.element=e,this.queueLimit=5,this.queue=[]}return _createClass(t,[{key:"show",value:function(e,t,n,a){this.element.classList.add(e),this.element.innerHTML=t,setTimeout(function(){this.element.className="",a.bind(this)()}.bind(this),n)}},{key:"queueMessage",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"empty",e=("empty"!==e&&this.queue.length+1<=this.queueLimit&&this.queue.push({type:e,message:1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",duration:2<arguments.length&&void 0!==arguments[2]?arguments[2]:1500,active:!1,done:!1}),this.queue[0]);!e||e.active||e.done||(this.queue[0].active=!0,this.show(e.type,e.message,e.duration,function(){this.queue[0].done=!0,this.queue.shift(),this.queueMessage()}))}}]),t}(),mainGridDOM=document.getElementById("main-grid"),orientationWarningDOM=document.getElementById("orientation-warning");function mainGridOrientationCheck(){if(window.innerHeight>=window.innerWidth)return mainGridDOM.style.display="none",void(orientationWarningDOM.style.display="block");mainGridDOM.style.removeProperty("display"),orientationWarningDOM.style.removeProperty("display")}window.addEventListener("resize",function(){mainGridOrientationCheck()}),mainGridOrientationCheck();var stableMarriageConfiguration,stableMarriageAlgorithm,stableMarriageNameIndex,TimeoutQueue=function(){function e(){_classCallCheck(this,e),this.queue=[],this.disable=!1}return _createClass(e,[{key:"add",value:function(e,t){var n;2<arguments.length&&void 0!==arguments[2]&&arguments[2]||this.queue.push({callback:e,duration:t,active:!1,done:!1}),this.disable||(!(n=this.queue[0])||n.active||n.done||(this.queue[0].active=!0,setTimeout(function(){try{this.queue[0].done=!0,n.callback(),this.queue.shift(),this.add(null,null,!0)}catch(e){}}.bind(this),n.duration)))}},{key:"pause",value:function(){this.disable=!0}},{key:"clear",value:function(){this.queue=[]}},{key:"continue",value:function(){this.disable=!1,this.add(null,null,!0)}}]),e}(),maleDOM=document.getElementById("male"),groundDOM=document.getElementById("ground"),femaleDOM=document.getElementById("female"),maleAddDOM=document.getElementById("male-add"),femaleAddDOM=document.getElementById("female-add"),controlsDOM=document.getElementById("main-controls"),randomConfigurationDOM=document.getElementById("random-configuration"),resetDefaultDOM=document.getElementById("reset-default"),saveConfigurationDOM=document.getElementById("save-configuration"),fileInputDOM=document.getElementById("file-input"),fileInputLabelDOM=document.getElementById("file-input-label"),playVisualizationDOM=document.getElementById("play-visualization"),pauseVisualizationDOM=document.getElementById("pause-visualization"),stopVisualizationDOM=document.getElementById("stop-visualization"),skipVisualizationDOM=document.getElementById("skip-visualization"),notifier=new Notifier(document.getElementById("notifier")),stableMarriageProcessQueue=[],stableMarriageVisualizationRunning=!1,stableMarriageVisualizationDone=!1,animationQueue=new TimeoutQueue;function clone(e){return JSON.parse(JSON.stringify(e))}function shuffleArray(e){for(var t,n,a=e.length;0!==a;)n=Math.floor(Math.random()*a),t=e[--a],e[a]=e[n],e[n]=t;return e}function randomArrayOfSize(e,t){return shuffleArray(clone(e)).slice(0,t)}function createRandomConfiguration(e,t){var n,a=randomArrayOfSize(maleNames,e),i=randomArrayOfSize(femaleNames,t),r={male:[],female:[]},l=_createForOfIteratorHelper(a);try{for(l.s();!(n=l.n()).done;){var o=n.value;r.male.push({name:o,preferences:shuffleArray(clone(i))})}}catch(e){l.e(e)}finally{l.f()}var s,u=_createForOfIteratorHelper(i);try{for(u.s();!(s=u.n()).done;){var c=s.value;r.female.push({name:c,preferences:shuffleArray(clone(a))})}}catch(e){u.e(e)}finally{u.f()}return r}function getRandomName(e){e="male"===e?maleNames:femaleNames;return e[Math.floor(Math.random()*e.length)]}function nameIndexMap(e){var t,n={};for(t in e)for(var a=0;a<e[t].length;++a)n[e[t][a].name]=a;return n}function getDOMNameIndexMap(){for(var e={},t=0,n=[].concat(_toConsumableArray(maleDOM.children),_toConsumableArray(femaleDOM.children));t<n.length;t++){var a=n[t];a.classList.contains("entity")&&(e[(a=a.querySelector(".name input")).value]=parseInt(a.dataset.index))}return e}function getDOMConfiguration(){for(var e={male:[],female:[]},t=0,n=[].concat(_toConsumableArray(maleDOM.children),_toConsumableArray(femaleDOM.children));t<n.length;t++){var a=n[t];if(!a.classList.contains("add-entity")){var i,r=a.parentNode==maleDOM?"male":"female",l=a.querySelector(".name input").value,o=[],s=_createForOfIteratorHelper(a.querySelector(".preference").children);try{for(s.s();!(i=s.n()).done;){var u=i.value;o.push(u.innerText)}}catch(e){s.e(e)}finally{s.f()}e[r].push({name:l,preferences:o})}}return e}function clientSaveFile(e,t,n){var a,i,e=new Blob([e],{type:n});window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(e,t):(a=document.createElement("a"),i=URL.createObjectURL(e),a.href=i,a.download=t,document.body.appendChild(a),a.click(),setTimeout(function(){document.body.removeChild(a),window.URL.revokeObjectURL(i)},0))}function calculateOpenEntityHeight(e){e=e.querySelector(".preference");return e.children[0].offsetHeight*(e.children.length+1)}function entityPreferenceClick(e){e=e.currentTarget.parentElement.parentElement;e.classList.contains("edit-preference")?e.style.removeProperty("min-height"):e.style.minHeight=calculateOpenEntityHeight(e)+"px",e.classList.toggle("edit-preference")}function entityNameInput(e){var t=e.currentTarget,n=t.selectionStart,a=/[^a-z]/gi,i=t.value;a.test(i)&&(t.value=i.replace(a,""),n--),t.setSelectionRange(n,n);for(var r=e.srcElement.parentElement.parentElement.parentElement==maleDOM?femaleDOM:maleDOM,l=0;l<r.children.length-1;++l){var o,s=_createForOfIteratorHelper(r.children[l].querySelector(".preference").children);try{for(s.s();!(o=s.n()).done;){var u=o.value;u.dataset.index==t.dataset.index&&(u.innerHTML=t.value)}}catch(e){s.e(e)}finally{s.f()}}}function entityRemoveClick(e){var t=e.currentTarget.parentNode.parentNode,e=t.parentNode;if(e.children.length-1<=defaultEntityCountMinimum)notifier.queueMessage("warning","Number of entities cannot go below minimum (".concat(defaultEntityCountMinimum,")."),500);else{var c,d=e==maleDOM?femaleDOM:maleDOM,n=t.querySelector(".name input").dataset.index,a=_createForOfIteratorHelper(e.children);try{for(a.s();!(c=a.n()).done;){var m,f,h=c.value;h==t||h.classList.contains("add-entity")||(m=h.querySelector(".name input"),n<(f=parseInt(m.dataset.index))&&(m.dataset.index=f-1))}}catch(e){a.e(e)}finally{a.f()}var g,i=_createForOfIteratorHelper(d.children);try{for(i.s();!(g=i.n()).done;){var r=g.value;if(!r.classList.contains("add-entity")){var p,y=r.querySelector(".preference"),v=void 0,l=void 0,o=_createForOfIteratorHelper(y.children);try{for(o.s();!(p=o.n()).done;){var s=p.value,u=parseInt(s.dataset.index);u==n?v=s:u-1==n?l=s:n<u&&(s.dataset.index=u-1)}}catch(e){o.e(e)}finally{o.f()}l&&(l.dataset.index=parseInt(l.dataset.index)-1),v.remove(),r.classList.contains("edit-preference")&&(r.style.minHeight=calculateOpenEntityHeight(r)+"px")}}}catch(e){i.e(e)}finally{i.f()}t.remove()}}function preferenceDrag(e){var t=e.target,n=t.parentNode,a=(t.classList.add("dragging"),e.clientX),e=e.clientY,a=document.elementFromPoint(a,e);(a=null==a?t:a).parentNode==n&&(a=a!==t.nextSibling?a:a.nextSibling,n.insertBefore(t,a))}function preferenceDragEnd(e){e.target.classList.remove("dragging")}function createSMEntityElement(){var e=document.createElement("div");return e.className="entity",e.innerHTML='\n        <div class="name">\n            <button class="toggle-preference"><i class="fas fa-angle-right"></i></button> \n            <input maxlength="'.concat(defaultEntityNameMaximum,'" type="text" value="Name" placeholder="Enter Name">\n            <button class="remove-entity"><i class="fas fa-trash"></i></button>\n        </div>\n        <div class="preference">\n            \x3c!-- Put prefs here separated with <div> tags --\x3e\n        </div>\n\n    '),e}function initializeEntityElement(e,t,c,n){var a=e.querySelector(".name input"),i=e.querySelector(".name .toggle-preference"),r=e.querySelector(".name .remove-entity"),l=e.querySelector(".preference");a.value=c,a.dataset.index=t[c],a.oninput=entityNameInput,"true"!=i.getAttribute("haslistener")&&i.addEventListener("click",entityPreferenceClick),"true"!=r.getAttribute("haslistener")&&r.addEventListener("click",entityRemoveClick),i.setAttribute("haslistener","true"),r.setAttribute("haslistener","true");for(var o=0;o<n.length;++o){var d=n[o],s=void 0;l.children.length-1<o?((s=document.createElement("div")).addEventListener("drag",preferenceDrag),s.addEventListener("dragend",preferenceDragEnd),l.appendChild(s)):s=l.children[o],s.draggable=!0,s.dataset.index=t[d],s.innerHTML=d}for(var u=l.children.length-1;u>=n.length;--u)l.children[u].remove();return e}function populateDOM(i){var r,l=nameIndexMap(i),o=new TimeoutQueue;for(r in i){for(var s="male"==r?maleDOM:femaleDOM,u="male"==r?maleAddDOM:femaleAddDOM,e=(s.children.length,i[r].length,0);e<i[r].length;++e)!function(e){var t=i[r][e],n=t.name,t=t.preferences,a=void 0;e<s.children.length-1?a=s.children[e]:((a=createSMEntityElement()).style.opacity="0",s.insertBefore(a,u),o.add(function(){a.style.removeProperty("opacity")},100)),initializeEntityElement(a,l,n,t),a.classList.contains("edit-preference")&&(a.style.minHeight=calculateOpenEntityHeight(a)+"px")}(e);for(var t=s.children.length-2;t>=i[r].length;--t)s.children[t].remove()}}function addEntityClick(e){var t=e.currentTarget.parentNode;if(t.children.length-1>=defaultEntityCountMaximum)notifier.queueMessage("warning","Maximum number of entities (".concat(defaultEntityCountMaximum,") has been reached."),500);else if(stableMarriageVisualizationRunning)notifier.queueMessage("warning","Use stop button to edit configuration.");else{for(var n,a=t==maleDOM?"male":"female",c="male"==a?femaleDOM:maleDOM,d=createSMEntityElement(),i=getDOMNameIndexMap(),m=[];n=getRandomName(a),-1!=Object.keys(i).indexOf(n););i[n]=t.children.length-1;var f,r=_createForOfIteratorHelper(c.children);try{for(r.s();!(f=r.n()).done;){var l,o,s,u=f.value;u.classList.contains("add-entity")||(l=u.querySelector(".preference"),(o=document.createElement("div")).draggable=!0,o.dataset.index=i[n],o.innerHTML=n,o.addEventListener("drag",preferenceDrag),o.addEventListener("dragend",preferenceDragEnd),l.appendChild(o),(s=l.parentNode).classList.contains("edit-preference")&&(s.style.minHeight=calculateOpenEntityHeight(s)+"px"),m.push(u.querySelector(".name input").value))}}catch(e){r.e(e)}finally{r.f()}initializeEntityElement(d,i,n,shuffleArray(m)),t.insertBefore(d,e.currentTarget)}}function randomConfigurationClick(e){var t=defaultEntityCountMaximum-defaultEntityCountMinimum;populateDOM(createRandomConfiguration(Math.floor(Math.random()*(1+t))+defaultEntityCountMinimum,Math.floor(Math.random()*(1+t))+defaultEntityCountMinimum)),notifier.queueMessage("valid","Configuration has been randomized.",500)}function resetDefaultClick(e){populateDOM(defaultAlgorithmConfiguration),notifier.queueMessage("valid","Configuration has been reset to default.",1e3)}function saveConfigurationClick(e){isValidAlgorithmConfiguration(getDOMConfiguration())?(clientSaveFile(JSON.stringify(getDOMConfiguration(),null,4),"configuration.json","application/json"),notifier.queueMessage("valid","The configuration file is being saved at your device as configuration.json")):notifier.queueMessage("error","Configuration is invalid. Please use unique names for all entities.")}function validateJSONConfiguration(e){var t=e.male,n=e.female;if(!t||!Array.isArray(t))throw"Missing male array in configuration object.";if(!n||!Array.isArray(n))throw"Missing female array in configuration object.";if(t.length<defaultEntityCountMinimum)throw"Male array does not meet minimum length of required elements.";if(t.length>defaultEntityCountMaximum)throw"Male array exceeds maximum length of required elements.";if(n.length<defaultEntityCountMinimum)throw"Female array does not meet minimum length of required elements.";if(n.length>defaultEntityCountMaximum)throw"Female array exceeds maximum length of required elements.";for(var a=0,i=[].concat(_toConsumableArray(t),_toConsumableArray(n));a<i.length;a++){var r=i[a],l=r.name,r=r.preferences;if(!l||!r)throw"An entity is missing required fields.";if(!("string"==typeof l||l instanceof String)||l.length>defaultEntityNameMaximum||/[^a-z]/gi.test(l))throw"An entity has an invalid name.";if(!Array.isArray(r)||!r.every(function(e){return"string"==typeof e||e instanceof String}))throw"An entity has invalid preferences."}if(!isValidAlgorithmConfiguration(e))throw"The configuration is invalid due to inconsistencies in entity occurence."}function fileInputChange(n){var e=n.target.files[0],t=new FileReader;t.readAsText(e,"UTF-8"),t.addEventListener("load",function(e){try{var t=JSON.parse(e.target.result);validateJSONConfiguration(t),notifier.queueMessage("valid","Configuration loaded successfully."),populateDOM(t)}catch(e){notifier.queueMessage("error",e)}finally{n.target.value=""}})}function highlightEntityDOM(e){animationQueue.add(function(){e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("prepare")},250)}function openAndSelectGroundDOM(e,t){animationQueue.add(function(){e.style.removeProperty("opacity")},250),animationQueue.add(function(){e.classList.add("expand-preference"),e.style.minHeight=calculateOpenEntityHeight(e)+"px"},250),animationQueue.add(function(){e.scrollIntoView({behavior:"smooth",block:"center"})},250),null!=t&&animationQueue.add(function(){e.querySelector(".preference").children[t].classList.add("select-highlight")},500)}function closeGroundDOM(e){animationQueue.add(function(){e.style.removeProperty("min-height"),e.classList.remove("expand-preference"),e.querySelector(".preference").remove()},500)}function makeResultInteractable(){if(stableMarriageAlgorithm){stableMarriageVisualizationDone=stableMarriageVisualizationRunning=!0,animationQueue.clear(),maleDOM.classList.remove("disabled"),groundDOM.classList.remove("disabled"),femaleDOM.classList.remove("disabled"),groundDOM.innerHTML="";for(var e=0,t=[].concat(_toConsumableArray(stableMarriageAlgorithm.male),_toConsumableArray(stableMarriageAlgorithm.female));e<t.length;e++){var n=t[e],a=n.element,i=a.querySelector(".name input"),r=a.querySelector(".name .toggle-preference"),l=a.querySelector(".name .remove-entity");i.classList.add("disabled"),r.removeEventListener("click",entityPreferenceClick),a.addEventListener("click",entityPartnerShowClick),l.removeEventListener("click",entityRemoveClick),a.classList.add("prepare"),a.classList.remove("disabled"),null!==n.partner?a.classList.add("marry"):a.classList.add("reject")}}}function animationStep(){var e,n,t=stableMarriageProcessQueue.shift(),a=t.process,t=t.content,i=t.male,r=t.female,l=t.dumped;if("done"!==a&&(e=i.element.cloneNode(!0),n=r.element.cloneNode(!0),e.style.opacity="0",n.style.opacity="0",e.classList.add("prepare"),n.classList.add("prepare"),e.classList.add("disabled"),n.classList.add("disabled"),"prepare"!==a&&(groundDOM.appendChild(e),openAndSelectGroundDOM(e,i._preferences.indexOf(r.name)))),"prepare"==a)highlightEntityDOM(i.element);else if("engage"==a)highlightEntityDOM(r.element),groundDOM.appendChild(n),openAndSelectGroundDOM(n),closeGroundDOM(e),closeGroundDOM(n),animationQueue.add(function(){e.classList.remove("reject"),n.classList.remove("prepare"),e.classList.add("engage"),n.classList.add("engage")},500),animationQueue.add(function(){i.element.classList.remove("reject"),i.element.classList.add("engage"),r.element.classList.add("engage"),notifier.queueMessage("warning","".concat(i.name," is engaged with ").concat(r.name,"."),1e3)},500);else if("break"==a){n.classList.add("engage");t=r._preferences.indexOf(l.name);n.querySelector(".preference").children[t].classList.add("partner-highlight"),groundDOM.appendChild(n),openAndSelectGroundDOM(n),animationQueue.add(function(){var e=n.querySelector(".preference"),t=r._preferences.indexOf(i.name);r._preferences.indexOf(l.name);e.children[t].classList.add("select-highlight"),notifier.queueMessage("warning","".concat(r.name," breaks up with current partner ").concat(l.name," and engages with ").concat(i.name,"."),2e3)},500),closeGroundDOM(e),closeGroundDOM(n),animationQueue.add(function(){e.classList.remove("reject"),e.classList.add("engage"),i.element.classList.remove("reject"),i.element.classList.add("engage"),l.element.classList.remove("engage"),l.element.classList.add("reject")},500)}else if("reject"==a){n.classList.add("engage");var o=n.querySelector(".preference"),t=r._preferences.indexOf(r.partner.name);o.children[t].classList.add("partner-highlight"),groundDOM.appendChild(n),openAndSelectGroundDOM(n),animationQueue.add(function(){var e=r._preferences.indexOf(i.name);o.children[e].classList.add("select-highlight")},250),closeGroundDOM(e),closeGroundDOM(n),animationQueue.add(function(){e.classList.remove("prepare"),n.classList.remove("engage"),e.classList.add("reject"),n.classList.add("reject"),notifier.queueMessage("warning","".concat(r.name," stays with current partner ").concat(r.partner.name," and rejects ").concat(i.name,"."),2e3)},250),animationQueue.add(function(){i.element.classList.add("reject"),r.element.classList.add("reject")},250),animationQueue.add(function(){r.element.classList.remove("reject"),r.element.classList.add("engage")},250)}else if("done"==a){var s,u=_createForOfIteratorHelper(groundDOM.children);try{for(u.s();!(s=u.n()).done;)s.value.style.opacity="0"}catch(e){u.e(e)}finally{u.f()}animationQueue.add(function(){groundDOM.innerHTML=""},250)}0==stableMarriageProcessQueue.length?(skipVisualizationDOM.classList.add("disabled"),makeResultInteractable(),notifier.queueMessage("valid","Tap an entity to show its partner.")):animationQueue.add(function(){animationStep()},250)}function playVisualizationClick(u){if(stableMarriageVisualizationDone||stableMarriageVisualizationRunning)stableMarriageVisualizationRunning&&animationQueue.disable?(animationQueue.continue(),notifier.queueMessage("valid","Visualization continuing.")):notifier.queueMessage("warning","Use the stop button to reset the visualization.");else if(isValidAlgorithmConfiguration(stableMarriageConfiguration=getDOMConfiguration())){for(stableMarriageNameIndex=nameIndexMap(stableMarriageConfiguration),stableMarriageAlgorithm=new StableMarriage(getDOMConfiguration(),stableMarriageNameIndex),stableMarriageProcessQueue=[];!stableMarriageAlgorithm.isDone();)stableMarriageAlgorithm.iterate(),stableMarriageProcessQueue.push.apply(stableMarriageProcessQueue,_toConsumableArray(stableMarriageAlgorithm.log.getCurrent()));animationQueue.disable=!1;var e,t,n=_createForOfIteratorHelper(controlsDOM.children);try{for(n.s();!(e=n.n()).done;){var a=e.value;a==pauseVisualizationDOM||a==stopVisualizationDOM||a==skipVisualizationDOM?a.classList.remove("disabled"):a!==playVisualizationDOM&&a.classList.add("disabled")}}catch(e){n.e(e)}finally{n.f()}for(t in maleDOM.classList.add("disabled"),femaleDOM.classList.add("disabled"),stableMarriageConfiguration){var i,r="male"==t?maleDOM:femaleDOM,l=_createForOfIteratorHelper(stableMarriageAlgorithm[t]);try{for(l.s();!(i=l.n()).done;){var o=i.value,s=r.children[stableMarriageNameIndex[o.name]];s.classList.remove("edit-preference"),s.style.removeProperty("min-height"),s.classList.add("disabled"),o.element=s}}catch(e){l.e(e)}finally{l.f()}}notifier.queueMessage("valid","Visualization start."),stableMarriageVisualizationRunning=!0,animationStep()}else notifier.queueMessage("warning","Configuration is invalid. Please use unique names for all entities.")}function pauseVisualizationClick(e){animationQueue.disable||!stableMarriageVisualizationRunning||stableMarriageVisualizationDone||(animationQueue.pause(),notifier.queueMessage("valid","Visualization paused."))}function stopVisualizationClick(e){animationQueue.clear(),stableMarriageNameIndex=stableMarriageAlgorithm=null,stableMarriageVisualizationDone=stableMarriageVisualizationRunning=!(stableMarriageProcessQueue=[]);var t,n=_createForOfIteratorHelper(controlsDOM.children);try{for(n.s();!(t=n.n()).done;){var a=t.value;a==pauseVisualizationDOM||a==stopVisualizationDOM||a==skipVisualizationDOM?a.classList.add("disabled"):a.classList.remove("disabled")}}catch(e){n.e(e)}finally{n.f()}maleDOM.classList.remove("disabled"),femaleDOM.classList.remove("disabled"),groundDOM.classList.add("disabled");for(var i=new TimeoutQueue,r=0,l=[].concat(_toConsumableArray(maleDOM.children),_toConsumableArray(femaleDOM.children),_toConsumableArray(groundDOM.children));r<l.length;r++)!function(){var e=l[r];if(e.classList.contains("add-entity"))return;e.style.opacity="0",i.add(function(){e.remove()},10)}();i.add(function(){populateDOM(stableMarriageConfiguration)},200)}function entityPartnerShowClick(e){var t,n,e=e.currentTarget,a=e.querySelector(".name input").dataset.index,i=e.parentNode==maleDOM?"male":"female",i=stableMarriageAlgorithm[i][a];i.partner?(groundDOM.innerHTML="",a=i.partner,e=e.cloneNode(!0),t=a.element.cloneNode(!0),n=a._preferences.indexOf(i.name),a=i._preferences.indexOf(a.name),e.querySelector(".preference").children[a].classList.add("marry-highlight"),t.querySelector(".preference").children[n].classList.add("marry-highlight"),groundDOM.appendChild(e),groundDOM.appendChild(t),openAndSelectGroundDOM(e),openAndSelectGroundDOM(t)):notifier.queueMessage("warning","".concat(i.name," has no partner."))}function skipVisualizationClick(e){stableMarriageVisualizationRunning&&!stableMarriageVisualizationDone&&(e.currentTarget.classList.add("disabled"),makeResultInteractable(),notifier.queueMessage("valid","Toggle an entity with their angle button to see their partner."))}populateDOM(defaultAlgorithmConfiguration),maleAddDOM.addEventListener("click",addEntityClick),femaleAddDOM.addEventListener("click",addEntityClick),randomConfigurationDOM.addEventListener("click",randomConfigurationClick),resetDefaultDOM.addEventListener("click",resetDefaultClick),saveConfigurationDOM.addEventListener("click",saveConfigurationClick),fileInputDOM.addEventListener("change",fileInputChange),playVisualizationDOM.addEventListener("click",playVisualizationClick),pauseVisualizationDOM.addEventListener("click",pauseVisualizationClick),stopVisualizationDOM.addEventListener("click",stopVisualizationClick),skipVisualizationDOM.addEventListener("click",skipVisualizationClick);